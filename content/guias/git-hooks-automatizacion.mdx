---
title: ü§ñ Git Hooks y Automatizaci√≥n
description: Automatiza tu flujo de trabajo con Git hooks. Pre-commit, post-commit, pre-push y m√°s. Integraci√≥n con CI/CD.
level: Avanzado
duration: 35 min
difficulty: 4
author: Learning Git
date: 2024-01-20
topics:
  - Client-side hooks
  - Server-side hooks 
  - Pre-commit automation
  - Linting y testing
  - CI/CD integration
  - Custom hooks
---

# ü§ñ Git Hooks y Automatizaci√≥n

Los Git hooks son scripts que se ejecutan autom√°ticamente en ciertos eventos del flujo de trabajo de Git. Son una herramienta poderosa para automatizar tareas, validar c√≥digo y mantener la calidad del proyecto.

## ¬øQu√© son los Git Hooks?

Los hooks son scripts personalizables que Git ejecuta antes o despu√©s de eventos espec√≠ficos como commits, pushes, merges, etc. Te permiten automatizar tareas repetitivas y establecer pol√≠ticas de calidad de c√≥digo.

### Tipos de Hooks

**Client-side hooks:**
- `pre-commit`: Se ejecuta antes de hacer commit
- `prepare-commit-msg`: Se ejecuta antes de editar el mensaje de commit
- `commit-msg`: Se ejecuta para validar el mensaje de commit
- `post-commit`: Se ejecuta despu√©s de hacer commit
- `pre-push`: Se ejecuta antes de hacer push

**Server-side hooks:**
- `pre-receive`: Se ejecuta cuando se reciben objetos
- `post-receive`: Se ejecuta despu√©s de recibir objetos
- `update`: Se ejecuta para cada branch que se actualiza

## Configuraci√≥n de Hooks

Los hooks se almacenan en `.git/hooks/` y deben ser ejecutables:

```bash
# Ver hooks disponibles
ls .git/hooks/

# Crear un hook pre-commit
touch .git/hooks/pre-commit
chmod +x .git/hooks/pre-commit
```

### Ejemplo: Hook Pre-commit

```bash
#!/bin/sh
# .git/hooks/pre-commit

# Ejecutar linting
npm run lint
if [ $? -ne 0 ]; then
  echo "‚ùå Linting fall√≥. Corrige los errores antes de hacer commit."
  exit 1
fi

# Ejecutar tests
npm run test
if [ $? -ne 0 ]; then
  echo "‚ùå Tests fallaron. Corrige los errores antes de hacer commit."
  exit 1
fi

echo "‚úÖ Pre-commit hooks pasaron exitosamente."
```

## Herramientas Populares

### Husky
Simplifica la gesti√≥n de hooks en proyectos Node.js:

```bash
# Instalar Husky
npm install --save-dev husky

# Inicializar
npx husky init

# A√±adir hook
npx husky add .husky/pre-commit "npm run lint"
```

### lint-staged
Ejecuta linters solo en archivos staged:

```json
{
  "lint-staged": {
    "*.js": ["eslint --fix", "git add"],
    "*.css": ["stylelint --fix", "git add"]
  }
}
```

## Casos de Uso Comunes

### 1. Validaci√≥n de C√≥digo
```bash
#!/bin/sh
# Validar sintaxis antes de commit
php -l *.php
```

### 2. Formato de Mensaje de Commit
```bash
#!/bin/sh
# commit-msg hook
commit_regex='^(feat|fix|docs|style|refactor|test|chore): .{1,50}'

if ! grep -qE "$commit_regex" "$1"; then
    echo "‚ùå Formato de commit inv√°lido."
    echo "Usa: type: description"
    echo "Ejemplo: feat: a√±adir nueva funcionalidad"
    exit 1
fi
```

### 3. Prevenir Push a Master
```bash
#!/bin/sh
# pre-push hook
protected_branch='master'
current_branch=$(git rev-parse --abbrev-ref HEAD)

if [ $current_branch = $protected_branch ]; then
    echo "‚ùå Push directo a $protected_branch est√° prohibido."
    exit 1
fi
```

## Integraci√≥n con CI/CD

### GitHub Actions
```yaml
name: CI
on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
      - run: npm ci
      - run: npm run lint
      - run: npm test
```

### GitLab CI
```yaml
stages:
  - test
  - deploy

lint:
  stage: test
  script:
    - npm run lint

test:
  stage: test
  script:
    - npm test
```

## Mejores Pr√°cticas

### 1. Mant√©n los Hooks R√°pidos
```bash
# ‚úÖ Bueno: Solo archivos modificados
git diff --cached --name-only | grep '\.js$' | xargs eslint

# ‚ùå Malo: Todo el proyecto
eslint .
```

### 2. Proporciona Retroalimentaci√≥n Clara
```bash
echo "üîç Ejecutando tests..."
echo "‚úÖ Tests completados exitosamente"
echo "‚ùå Error: 3 tests fallaron"
```

### 3. Permite Bypass en Emergencias
```bash
# Permitir bypass con --no-verify
git commit --no-verify -m "hotfix: arreglo cr√≠tico"
```

### 4. Versiona tus Hooks
```bash
# Crear carpeta de hooks en el repo
mkdir .githooks
cp .git/hooks/pre-commit .githooks/

# Configurar Git para usar la carpeta
git config core.hooksPath .githooks
```

## Hooks Avanzados

### Hook de An√°lisis de Performance
```bash
#!/bin/sh
# post-commit hook para an√°lisis de performance

bundle_size_before=$(cat .bundle-size)
npm run build
bundle_size_after=$(wc -c < dist/bundle.js)

echo $bundle_size_after > .bundle-size

if [ $bundle_size_after -gt $((bundle_size_before + 10000)) ]; then
    echo "‚ö†Ô∏è  El bundle creci√≥ m√°s de 10KB"
    echo "Antes: ${bundle_size_before} bytes"
    echo "Despu√©s: ${bundle_size_after} bytes"
fi
```

### Hook de Validaci√≥n de Dependencias
```bash
#!/bin/sh
# pre-commit: verificar dependencias vulnerables

npm audit --audit-level high
if [ $? -ne 0 ]; then
    echo "‚ùå Vulnerabilidades cr√≠ticas encontradas"
    echo "Ejecuta: npm audit fix"
    exit 1
fi
```

## Herramientas Adicionales

### commitizen
Estandariza mensajes de commit:
```bash
npm install -g commitizen
npm install -g cz-conventional-changelog
echo '{ "path": "cz-conventional-changelog" }' > ~/.czrc
```

### conventional-changelog
Genera changelogs autom√°ticamente:
```bash
npm install --save-dev conventional-changelog-cli
npx conventional-changelog -p angular -i CHANGELOG.md -s
```

## Resoluci√≥n de Problemas

### Hook No Se Ejecuta
```bash
# Verificar permisos
ls -la .git/hooks/pre-commit
# Debe mostrar -rwxr-xr-x (ejecutable)

# Dar permisos
chmod +x .git/hooks/pre-commit
```

### Hook Falla Silenciosamente
```bash
# A√±adir debugging
echo "üîß Ejecutando pre-commit hook..." >&2
set -e  # Salir en cualquier error
```

### Compartir Hooks en el Equipo
```bash
# Crear script de setup
#!/bin/bash
# setup-hooks.sh
cp .githooks/* .git/hooks/
chmod +x .git/hooks/*
echo "‚úÖ Hooks instalados correctamente"
```

Los Git hooks son una herramienta fundamental para mantener la calidad del c√≥digo y automatizar workflows. Implementa hooks gradualmente y siempre proporciona documentaci√≥n clara para tu equipo.

## Ejercicios Pr√°cticos

1. **Hook Pre-commit B√°sico**: Crea un hook que ejecute linting antes de cada commit
2. **Validaci√≥n de Mensaje**: Implementa validaci√≥n de formato de mensajes de commit
3. **Hook de Testing**: Configura un hook que ejecute tests antes de push
4. **Integraci√≥n con CI**: Conecta hooks locales con pipeline de CI/CD
5. **Hook Personalizado**: Crea un hook que valide archivos espec√≠ficos de tu proyecto
